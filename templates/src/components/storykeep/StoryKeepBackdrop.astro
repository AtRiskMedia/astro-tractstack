---
let MODE = 'logo'; // 'wordmark' | 'logo'

interface Props {
  brandConfig: {
    LOGO?: string;
    WORDMARK?: string;
  };
}

const { brandConfig } = Astro.props;

const getAssetPath = (
  configPath: string | undefined,
  fallback: string
): string => {
  if (configPath && configPath !== '') {
    return configPath;
  }
  return fallback;
};

let assetUrl;
if (MODE === `wordmark`)
  assetUrl = getAssetPath(brandConfig?.WORDMARK, '/brand/wordmark.svg');
else assetUrl = getAssetPath(brandConfig?.LOGO, '/brand/logo.svg');

const generatePositions = () => {
  const positions = [];
  const rows = 15;
  const cols = 12;

  for (let row = 0; row < rows; row++) {
    for (let col = 0; col < cols; col++) {
      if ((row + col) % 3 !== 0) continue;
      const top = (row / (rows - 1)) * 120 - 10;
      const left = (col / (cols - 1)) * 120 - 10;
      const rotation = -45 + Math.random() * 90;
      positions.push({
        top: `${top}%`,
        left: `${left}%`,
        rotation: rotation,
      });
    }
  }

  return positions;
};

const logoPositions = generatePositions();
---

{
  assetUrl && (
    <div
      class="pointer-events-none absolute mr-6 overflow-hidden rounded-2xl p-1.5 md:p-3.5"
      style={{
        top: '2rem',
        left: '64rem',
        right: '0',
        bottom: '3.5rem',
        'mix-blend-mode': 'multiply',
        opacity: '0.07',
        border: '2px dashed rgba(0, 0, 0, 1)',
      }}
    >
      <svg
        width="100%"
        height="100%"
        xmlns="http://www.w3.org/2000/svg"
        style="overflow: visible;"
      >
        <defs>
          <symbol id="brand-logo-symbol" viewBox="0 0 120 120">
            <image href={assetUrl} width="120" height="120" />
          </symbol>
        </defs>
        {logoPositions.map((pos) => (
          <g
            transform={`translate(${parseFloat(pos.left) * 0.01 * 100} ${parseFloat(pos.top) * 0.01 * 100})`}
          >
            <use
              href="#brand-logo-symbol"
              x={pos.left}
              y={pos.top}
              width="120"
              height="120"
              transform={`rotate(${pos.rotation}, 60, 60)`}
              transform-origin="center"
            />
          </g>
        ))}
        {/* Simplified positioning to ensure browser compatibility with percentages */}
        {logoPositions.map((pos) => (
          <use
            href="#brand-logo-symbol"
            x={pos.left}
            y={pos.top}
            width="120"
            height="120"
            style={`transform: rotate(${pos.rotation}deg); transform-origin: center; transform-box: fill-box;`}
          />
        ))}
      </svg>
    </div>
  )
}
